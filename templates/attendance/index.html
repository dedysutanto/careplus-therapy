{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarePlus - Absensi Terapi Siswa</title>
    
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script> 
        function validateAnggota(elem) {
            let text_split = elem.val().split(".");
            if (text_split.length > 1) {
                let nia = text_split[0];
                console.log(nia);
                $.ajax('{% url 'attendance_get-student-detail' %}?term=' + nia,
                    {
                        success: function(data, status, jqHXR) {
                            if (data['status'] == false) {
                                alert('Nama siswa salah. Harap memilih dari daftar yang ada.');
                                elem.val('');
                                elem.focus();
                            } else {
                                $("#section_detail_usulan").css('display', 'block');
                                let schedules = data['schedules'];
                                //console.log(schedules);
                                if (schedules) {
                                for(let i=0; i<schedules.length; i++) {
                                    $("#schedules_detail").append('<h4>Tanggal: ' + schedules[i].date + '</h4>');
                                    $("#schedules_detail").append('<h4>Jam: ' + schedules[i].start + ' - ' + schedules[i].end + '</h4>');
                                    $("#schedules_detail").append('<h4>Therapist: ' + schedules[i].therapist + '</h4>');
                                    $("#schedules_detail").append('<h4>Activity: ' + schedules[i].activity + '</h4>');
                                    $("#schedules_detail").append('<br />');
                                }
                                } else {
                                    $("#schedules_detail").append('<h4>Tidak ada jadwal terapi.</h4>');
                                    $("#schedules_detail").append('<br />');

                                }       
                            } 
                        }
                });
            } else {
                alert('Nama siswa salah. Harap memilih dari daftar yang ada.');
                elem.val('');
                elem.focus();
            }
        }

    $( function() {
        $( "#student_name" ).autocomplete({
            source: "{% url 'attendance_get-student' %}"
        });

        $("#submit_button").css('visibility', 'hidden');
        
        $("#section_detail_usulan").css('display', 'none');

        
        $("#student_name").blur(function () {
            validateAnggota($(this));
        });

        $("#konfirmasi").click(function() {
            if($("#konfirmasi").is(':checked'))
                $("#submit_button").css('visibility', 'visible');  // checked
            else
                $("#submit_button").css('visibility', 'hidden');  // unchecked

        });

    });

function isEmail(email) {
  var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
  return regex.test(email);
}

function isMobile(mobile) {
  var regex = /^(\+62|62|0)8[1-9][0-9]{6,9}$/;
  return regex.test(mobile);
}

function validateMobile(elem) {
    if (! isMobile(elem.val())) {
        alert('Mohon memasukkan Nomer HP yang benar');
        elem.val('');
        elem.focus();
    }

}

function validateEmail(elem) {
    let email_val = elem.val();
    if (! isEmail(email_val)) {
        alert('Mohon alamat email yang benar');
        elem.val('');
        elem.focus();
    }
}

    </script>  
</head>
<body style="background-image: url('{% static 'attendance/img/cloud.png' %}'); background-size: 100% 100%; background-attachment: fixed; ">

<div class="container">
    <div class="card mb-5 mt-5">
        <div class="card-body">
            <h1 class="card-title">Absensi Terapi Siswa</h1>
            <hr />
            <p class="card-subtitle">
                Silakan ketikkan nama siswa dan pilih siswa yang akan melakukan terapi. Pastikan nama siswa sudah sesuai.
            </p>
            <br />
            <p class="card-subtitle">
                <span class="text-danger">* Harus diisi</span>
            </p>
            <!--
            <p class="card-subtitle">
                <span class="text-success">_ Boleh tidak diisi</span>
            </p>
            -->
        </div>
    </div>
<!-- Form Start -->
<form action="{% url 'attendance_scanner' %}" method="POST">
    {% csrf_token %}
    <div class="card mb-3 mt-5">
        <div class="card-body">
            <!--
            <label for="pengusul_email" class="form-label">Email Jemaat Pengusul</label>
            <div class="input-group mb-3">
                <span class="input-group-text text-danger" id="email_span">*</span>
                <input id="pengusul_email" name="pengusul_email" class="form-control" type="email" required="true">
            </div>
            -->

            <label for="student_name" class="form-label">Nama Siswa</label>
            <div class="input-group mb-3">
                <span class="input-group-text text-danger" id="email_span">*</span>
                <input id="student_name" name="student_name" type="text" class="form-control autocomplete-content" required="true">
            </div>
            <div id="student_detail">

            </div>
    
            <!--
            <label for="pengusul_mobile" class="form-label">Nomer HP Jemaat Pengusul</label>
            <div class="input-group mb3">
                <span class="input-group-text text-success" id="pengusul_mobile_span">_</span>
                <input id="pengusul_mobile" name="pengusul_mobile" type="text" class="form-control">
            </div>
            -->
        </div>
    </div>

    <div id="section_detail_usulan">
        <div class="card mb-3">
            <div id="schedules_detail" class="card-body">
                <h1>Jadwal Terapi Hari Ini</h1>
                <hr />
            </div>
        </div>
    </div>
    <div id="submit_button" class="card mb-5">
        <div class="card-body text-center">
            <button type="submit" class="btn btn-lg btn-primary">Kirim Usulan</button>
        </div>
    </div>
</form>
</div>

</body>
</html>
